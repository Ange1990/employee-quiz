<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Διαχείριση Ερωτήσεων</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; padding:20px; }
    h1 { text-align:center; margin-bottom:20px; }

    button {
      padding:8px 14px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      margin:5px;
    }
    #logout-btn { background:#ff4b2b; color:#fff; }
    #logout-btn:hover { background:#ff6a4d; }
    #back-btn { background:#007bff; color:#fff; }
    #back-btn:hover { background:#0056b3; }
    #add-btn { background:#28a745; color:#fff; }
    #add-btn:hover { background:#218838; }
    .delete-btn { background:#dc3545; color:#fff; }
    .delete-btn:hover { background:#c82333; }

    form {
      background:#fff;
      padding:20px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      margin-bottom:20px;
    }
    input, select, textarea {
      width:100%;
      padding:8px;
      margin:8px 0;
      border:1px solid #ccc;
      border-radius:6px;
    }

    table {
      width:100%;
      border-collapse: collapse;
      background:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    th, td {
      padding:10px;
      border-bottom:1px solid #eee;
      text-align:left;
    }
    th { background:#2575fc; color:#fff; }
    tr:nth-child(even) { background:#f9f9f9; }
  </style>
</head>
<body>

  <button id="back-btn">⬅ Επιστροφή στο Dashboard</button>
  <button id="logout-btn">Αποσύνδεση</button>
  <h1>Διαχείριση Ερωτήσεων</h1>

  <form id="question-form">
    <label for="question-text">Κείμενο Ερώτησης:</label>
    <textarea id="question-text" required></textarea>

    <label for="question-type">Τύπος Ερώτησης:</label>
    <select id="question-type">
      <option value="mcq">Πολλαπλής Επιλογής</option>
      <option value="open">Ανοικτή</option>
    </select>

    <div id="options-wrapper" style="display:none;">
      <label for="options-text">Επιλογές (μία ανά γραμμή):</label>
      <textarea id="options-text"></textarea>
    </div>

    <button type="submit" id="add-btn">Προσθήκη Ερώτησης</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Κείμενο</th>
        <th>Τύπος</th>
        <th>Επιλογές</th>
        <th>Ενέργειες</th>
      </tr>
    </thead>
    <tbody id="questions-body"></tbody>
  </table>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_MPxHrzLs2vd677t3Nr8vXKFtQEuLI2g",
      authDomain: "quiz-aa480.firebaseapp.com",
      projectId: "quiz-aa480",
      storageBucket: "quiz-aa480.appspot.com",
      messagingSenderId: "913659290274",
      appId: "1:913659290274:web:412b6ca878f15d094f6dfb",
      measurementId: "G-Q3X66T9MJF"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const form = document.getElementById("question-form");
    const textInput = document.getElementById("question-text");
    const typeSelect = document.getElementById("question-type");
    const optionsWrapper = document.getElementById("options-wrapper");
    const optionsText = document.getElementById("options-text");
    const questionsBody = document.getElementById("questions-body");
    const logoutBtn = document.getElementById("logout-btn");
    const backBtn = document.getElementById("back-btn");

    // Έλεγχος αν CEO
    auth.onAuthStateChanged(user => {
      if(!user) window.location.href="index.html";
      else if(user.email !== "nafpliotis@sspc.gr") {
        alert("Δεν έχετε πρόσβαση σε αυτή τη σελίδα.");
        window.location.href="index.html";
      } else {
        loadQuestions();
      }
    });

    // Logout
    logoutBtn.addEventListener("click", ()=>auth.signOut().then(()=>window.location.href="index.html"));
    backBtn.addEventListener("click", ()=>window.location.href="dashboard.html");

    // Εμφάνιση επιλογών μόνο αν MCQ
    typeSelect.addEventListener("change", ()=>{
      if(typeSelect.value==="mcq") optionsWrapper.style.display="block";
      else optionsWrapper.style.display="none";
    });

    // Υποβολή ερώτησης
    form.addEventListener("submit", e=>{
      e.preventDefault();
      const text = textInput.value.trim();
      const type = typeSelect.value;
      if(!text) return alert("Πληκτρολόγησε το κείμενο της ερώτησης.");
      let questionData = { text, type };
      if(type==="mcq"){
        const opts = optionsText.value.split("\n").map(o=>o.trim()).filter(Boolean);
        if(opts.length<2) return alert("Δώσε τουλάχιστον 2 επιλογές.");
        questionData.options = opts;
      }

      db.collection("questions").add(questionData)
        .then(()=>{
          alert("Η ερώτηση προστέθηκε!");
          form.reset();
          optionsWrapper.style.display="none";
          optionsText.value="";
          loadQuestions();
        })
        .catch(err=>console.error("Σφάλμα Firebase:", err));
    });

    // Φόρτωση ερωτήσεων
    function loadQuestions(){
      db.collection("questions").get()
        .then(snapshot=>{
          questionsBody.innerHTML="";
          snapshot.forEach(doc=>{
            const data = doc.data();
            const tr = document.createElement("tr");
            const optionsStr = data.type==="mcq" && data.options ? data.options.join(", ") : "-";
            tr.innerHTML = `
              <td>${data.text}</td>
              <td>${data.type==="mcq"?"Πολλαπλής":"Ανοιχτή"}</td>
              <td>${optionsStr}</td>
              <td><button class="delete-btn">Διαγραφή</button></td>
            `;
            tr.querySelector(".delete-btn").addEventListener("click", ()=>{
              if(confirm("Να διαγραφεί η ερώτηση;")){
                db.collection("questions").doc(doc.id).delete().then(()=>tr.remove());
              }
            });
            questionsBody.appendChild(tr);
          });
        });
    }
  </script>
</body>
</html>
